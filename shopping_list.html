<head>
    <style>
        div, span {
            font-size: 60px;
        }

        input {
            font-size: 1em;
        }

        button {
            font-size: 0.5em;
        }

        input[type=checkbox] {
            width: 40px;
            height: 40px;
        }
    </style>
    <script src="d3.min.js"></script>
    <script src="item.js"></script>
    <script>
 var target = null;

function EnterData(enter) {
    let span = enter.append("span");
    span.append("input").attr("type", "checkbox");
    span.append("text").text(item => item.name);
    span.append("button").text("Modify").on("click", function (e) {
        target = e.target.parentElement;
        //console.log(target.childNodes[1]);
        //console.log(target.textContent);
        let form = document.querySelector("#edit");
        form.querySelector("#item").value = target.childNodes[1].textContent;
        form.hidden = false;
    });
}

function UpdateData(update) {
    update.select("text").text(item => item.name);
}

function RefreshList() {
    Item.storeList();
    d3.select("body").selectAll("span").data(Item.list).join(EnterData, UpdateData);
}

function OnLoad() {
    console.log("OnLoad");
    /*
    let test = new Item();
    test.name = "tissue";
    Item.list.push(test);
    Item.list.push(new Item());
    */
    Item.loadList();
    RefreshList();
}

        function Del() {
            let idx = Item.list.indexOf(target.__data__);
            if (idx != (Item.list.length - 1)) {
                Item.list.splice(idx, 1);
                RefreshList();
            }
            document.querySelector("#edit").hidden = true;
        }

        function Cancel() {
            target = null;
            document.querySelector("#edit").hidden = true;
        }

function Update() {
    let form = document.querySelector("#edit");
    let name = form.querySelector("#item").value;
    target.__data__.name = name;
    form.hidden = true;
    if (Item.list[Item.list.length - 1].name.length)
        Item.list.push(new Item());
    RefreshList();
}
    </script>
</head>
<body onload="OnLoad()">
    <div hidden="true" id="edit">
        <input type="text" id="item">
        <button onclick="Update()">Update</button>
        <button onclick="Del()">Del</button>
        <button onclick="Cancel()">Cancel</button>
    </div>
    <!--
    <span><input type="checkbox">item1<button onclick="Edit(this)">Modify</button></span>
    <span><input type="checkbox">item2<button onclick="Edit(this)">Modify</button></span>
    <span><input type="checkbox"> <button onclick="Edit(this)">Modify</button></span>
    -->
</body>